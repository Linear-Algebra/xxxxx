<!DOCTYPE html>
<!-- saved from url=(0065)http://infoplus.seu.edu.cn/taskcenter/wechat/done?appCode=YJSFXSQ -->
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>已完成</title>

	<meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="cache-control" content="max-age=0">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="expires" content="Tue, 01 Jan 1970 1:00:00 GMT">
	<meta http-equiv="pragma" content="no-cache">


	<link rel="stylesheet" href="./firstPage/font-awesome.min.css">
	<link rel="stylesheet" href="./firstPage/jquery.gritter.css">
	<link rel="stylesheet" href="./firstPage/jstarbox.css">
	<link rel="stylesheet" href="./firstPage/rateit.css">


	<link rel="stylesheet" href="./firstPage/bootstrap.min.css">
	<link rel="icon" href="http://infoplus.seu.edu.cn/firstPage/gdut_favicon.ico" type="image/x-icon">
	<!-- ace styles -->
	<!--[if lte IE 9]>
<link rel="stylesheet" href="/taskcenter/resources/common/css/ace-part2.min.css?_v=20200923-213901" />
<link rel="stylesheet" href="/taskcenter/resources/common/css/ace-ie.min.css?_v=20200923-213901" />
<![endif]-->

	<!--[if lte IE 8]>
<link rel="stylesheet" href="/taskcenter/resources/common/css/ace-ie8.min.css?_v=20200923-213901" />
<![endif]-->

	<link rel="stylesheet" href="./firstPage/wechat.css">

	<!-- basic scripts -->
	<script src="./firstPage/json2.js"></script>
	<script src="./firstPage/jquery.min.js"></script>
	<script src="./firstPage/jquery.timestamp.js"></script>
	<script src="./firstPage/layer.js"></script>
	<link rel="stylesheet" href="./firstPage/layer.css" id="layuicss-skinlayercss">
	<script src="./firstPage/jquery.noty.packaged.min.js"></script>
	<script src="./firstPage/jquery.fly.js"></script>
	<script src="./firstPage/jquery-migrate-1.2.0.min.js"></script>
	<script src="./firstPage/jquery.placeholder.min.js"></script>
	<script src="./firstPage/jquery.cookie.js"></script>
	<script src="./firstPage/bootstrap.min.js"></script>
	<script src="./firstPage/bootbox.min.js"></script>

	<script src="./firstPage/jquery.gritter.min.js"></script>

	<script src="./firstPage/underscore-min.js"></script>
	<script src="./firstPage/backbone-min.js"></script>
	<script src="./firstPage/backbone.fetch-cache.min.js"></script>
	<script src="./firstPage/jstarbox.js"></script>

	<script src="./firstPage/jquery.rateit.js"></script>
	<script src="./firstPage/jquery.scrollLoading.min.js"></script>
	<script src="./firstPage/TouchSlide.1.1.js"></script>
	<script src="./firstPage/jquery.tinycarousel.js"></script>
	<script src="./firstPage/jquery.paging.js"></script>
	<script src="./firstPage/jquery.easy-paging.js"></script>
	<script src="./firstPage/jquery.easy-pie-chart.min.js"></script>
	<script src="./firstPage/jquery.SuperSlide.2.1.js"></script>

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lte IE 8]>
	<script src="/taskcenter/resources/common/js/html5shiv.js?_v=20200923-213901"></script>
	<script src="/taskcenter/resources/common/js/respond.min.js?_v=20200923-213901"></script>
	<![endif]-->
	<script src="./firstPage/jquery-textoverflow.js"></script>

	<script src="./firstPage/public.js"></script>


	<script>
		Global = {
			contentpath: "./",
			bodyHeight: $('body').height(),
			cacheTime: 6000,
			debugModal: false,
			CSRFToken: "bef18f01-1013-49bf-a554-2b67a0404fb4",
			resourceUrl: "/taskcenter/resources/seu/default",
			resSys: "/taskcenter/resources/common",
			userId: "d4ffb101-0153-11eb-987b-0242ac110002",
			loginName: "伍韬",
			membership: "",
			deviceName: "mobile",
			tag: "",
			pathName: "done",
			supportFrame: "include",
			loginStatus: "",
			imageUrl: "http://infoplus.seu.edu.cn/infoplus/file/enterprise/88a31c47-5262-4c5a-9a5e-486a2f93f2c5/icon",
			contentSelector: ".contents",
			templateSelector: "#contentsTemplate",
			scrollTop: true,
			titleMap: {},
			hash: "",
			dataName: "dones",
			isLoading: true,
			loginUrl: "",
			version: "20200923-213901",
			isDebug: "false",
			locale: "zh",
			positionTag: "",
			isTeacher: "false",
			homeAccessTimes: "",
			hrbeuCmsUrl: "",
			locationHost: "http://infoplus.seu.edu.cn/taskcenter/",
			order: "auto"
		};

		Global._parameter = {};
		Global.apps = [];
		Global.todos = [];
		Global.doings = [];
		Global.dones = [];
		Global.unrates = [];
		Global.completeds = [];
		Global.ccs = [];
		Global.merges = [];
		Global.selectorMap = {
			".btn-favorite": "click", ".btn-favorite-remove": "click"
			, ".tag-select": "change", ".search-input": "keydown", ".btn-search-input": "click"
		};
		Global.hashMap = {
			"apps": "contentsTemplate", "audit": "contentsAuditTemplate", "todo": "contentsTodoTemplate"
			, "doing": "contentsDoingTemplate", "done": "contentsDoneTemplate", "unrate": "contentsUnrateTemplate"
			, "todohistory": "contentsTodoHistoryTemplate", "audithistory": "contentsAuditHistoryTemplate"
		};
		Global.apiMap = {
			"api/me/apps": "apps",
			 "api/me/tasks/todo": "todos", 
			 "api/me/processes/doing?limit=%s&start=%s&keyword=%s": "doings",
			//  "api/me/processes/done?limit=%s&start=%s&keyword=%s": "dones",
			 "api/processes_done.json": "dones",
			  "api/me/processes/completed?limit=%s&start=%s&keyword=%s": "completeds",
			// "api/process/%s": "processes", 
			"api/process_id.json": "processes", 
			"api/me/processes/merge": "merges", "api/me/processes/todo": "mergeTodos",
			"api/me/processes/unrated": "unrates", "api/me/processes/cc?limit=%s&start=%s&keyword=%s&unread=%s": "ccs"
		};
		Global.sepMap = { "audit": "true", "audithistory": "false", "completed": "true", "merge": "false", "approval": "true" };
		Global.defaultTags = { "ALL": "全部", "COLLECT": "收藏" };
		Global.query = { limit: 10, start: 0, pageSize: 10, data: {} };
		Global.rapidHandle = { checked: {}, names: {}, actions: {}, isFinshed: true };
		Global.rapidCc = { chooseAll: false, checked: {} };
		Global.app = { palette: "green" };
		Global.dataLength = {};
		Global.rate = {};
		if (Global.deviceName != 'mobile') {
			Global.scrollTop = false;
		}
		$.cookie.json = true;

	</script>
	<script src="./firstPage/flow.js"></script>


	<script type="text/javascript" src="./firstPage/slides.min.jquery.js"></script>
</head>

<body class="bgbody">

	<div class="stand-main-content contents">
		<div class="topHead todoHeader">
			<div class="search_div">
				<div class="search_form_todo">
					<input type="text" placeholder="请输入搜索内容" class="search_input_css_todo search-input">
					<input type="button" class="search_btn_css_todo btn-search-input">
				</div>
			</div>

			<ul class="mobile_nav">
				<li navtop="todo">
					<a href="http://infoplus.seu.edu.cn/taskcenter/wechat/todo?appCode=YJSFXSQ">
						<img src="./firstPage/nav_todo_banner_normal.png">
						<p>待办事项</p>


					</a>
				</li>
				<li navtop="myApply">
					<a href="http://infoplus.seu.edu.cn/taskcenter/wechat/myApply?appCode=YJSFXSQ">
						<img src="./firstPage/nav_apply_banner_normal.png">
						<p>我的申请</p>
					</a>
				</li>

				<li navtop="doing">
					<a href="http://infoplus.seu.edu.cn/taskcenter/wechat/doing?appCode=YJSFXSQ">
						<img src="./firstPage/nav_doing_banner_normal.png">
						<p>进行中</p>
					</a>
				</li>
				<li navtop="done" class="active">
					<a href="http://infoplus.seu.edu.cn/taskcenter/wechat/done?appCode=YJSFXSQ">
						<img src="./firstPage/nav_done_banner.png">
						<p>已完成</p>
					</a>
				</li>
			</ul>
		</div>

		<div class="app_container">
			<div class="layout">
				<ul class="app_List">

					<li>
						<a href="http://infoplus.seu.edu.cn/infoplus/form/YJSFXSQ/start?back=1&amp;x_posted=true">
							<img class="app_img" src="./firstPage/app_img_01.png"
								data-url="http://infoplus.seu.edu.cn/infoplus/file/enterprise/88a31c47-5262-4c5a-9a5e-486a2f93f2c5/icon/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%BF%94%E6%A0%A1%E7%94%B3%E8%AF%B7">
							<p class="app_name_p">研究生返校申请<span>(点击办理)</span></p>
							<p class="app_tag_p">部门：研究生院</p>
						</a>
					</li>

				</ul>
			</div>
		</div>


		<div class="mobile_content bottomBody todoBottomBody">

			<ul class="app_List item_list">


				<li>
					<a
						href="./render.htm">
						<p class="app_name_p">
							研究生返校申请审批_伍韬_仪器科学与工程学院
						</p>
						<p class="app_tag_p">流水号：92833</p>
						<p class="app_tag_p">当前步骤：</p>
						<p class="app_tag_p time">2020-12-26 17:00</p>
						<span class="circle_yellow"></span>
					</a>
					<a class="toDetail" href="javascript:;"
						process-identity="09c33007-ced3-4ff6-a716-36bb3915832f">明细</a>

					<a class="toComment" href="javascript:;" rate-identity="09c33007-ced3-4ff6-a716-36bb3915832f">评价</a>

				</li>


			</ul>


			<div class="paginationContainer">
				<ul id="app-pagination" pagination="" class="clearfix">
					<li><a data-page="1"
							href="http://infoplus.seu.edu.cn/taskcenter/wechat/done?appCode=YJSFXSQ#">上一页</a></li>
					<li class="current"><a data-page="1"
							href="http://infoplus.seu.edu.cn/taskcenter/wechat/done?appCode=YJSFXSQ#1">1</a></li>
					<li><a data-page="1"
							href="http://infoplus.seu.edu.cn/taskcenter/wechat/done?appCode=YJSFXSQ#">下一页</a></li>
				</ul>
			</div>

		</div>
	</div>
	<script id="contentsTemplate" type="text/template">
		<div class="index_search">
			<div class='header_search'>
				<div class="search_form">
					<input type="text" placeholder="搜索您想找的事宜" class="search_input_css search_input_in" />
					<input type="button"  class="search_btn_css search_btn_in" />
				</div>
					<a href="/taskcenter/logout" class="showPerson">伍韬，您好！</a>
			</div>
			
			<div class='logo_img'>
				<img src="./firstPage/logo.png" class="logo" />
				<img src="./firstPage/text.png" class="logo2" />
			</div>

			<div class='eventCenter'>
				<a href="<%-getLink('/taskcenter/wechat/appall')%>">
					<button class="eventImage">服务中心</button>
				</a>
				<a href="<%-getLink('/taskcenter/wechat/todo')%>">
					<%
						var todoCount=0;
						globalMap._todos=grepItem(globalMap.todos);
						if(globalMap._todos&&globalMap._todos.length>0){
							todoCount=globalMap._todos.length;
						}
					%>
					<button class="eventImage">个人中心
						<%if(todoCount>0){%>
							<div class="number"><%-todoCount%></div>
						<%}%>
					</button>
				</a>
			</div>
		</div>
		<div class="index_header">
			<img src="./firstPage/index_banner.jpg" class="mobile_banner" data-name="index_banner" data-url="http://infoplus.seu.edu.cn/infoplus/file/enterprise/88a31c47-5262-4c5a-9a5e-486a2f93f2c5/icon/index_banner"/>
			<div></div>
		</div>

		<!-- <ul class="index_nav">
			<li>
				<a href="/taskcenter/wechat/appall">
					<p>服务中心</p>
					<span>您可以申请的所有事项</span>
				</a>
			</li>
			<li>
				<%
					var todoCount=0;
					if(globalMap.todos&&globalMap.todos.length>0){
						todoCount=globalMap.todos.length;
					}
				%>
				<a href="/taskcenter/wechat/todo">
					<p>个人中心</p>
					<span>
						您有<span class="count1"><%-todoCount%></span>项待办理的事项
					</span>
					<%if(todoCount>0){%>
						<span class="count"><%-todoCount%></span>
					<%}%>
				</a>
			</li>
		</ul> -->

		<div class="index_content">
			<p class="index_title">推荐服务</p>
			<ul class="recommended_List">
				<%
					globalMap.recommends=$.grep(globalMap.recommends,function(app){
						var tags=app.tags;
		    			var tagSplit=tags.split(",");
		    			if(tagSplit.length>=5&&tagSplit[4]=="移动端"){
		    				return true;
		    			}
		    			return false;
					})
				%>
				<% if(globalMap.recommends && globalMap.recommends.length){%>
					<%
						var newList = []
						for(var i=0;i<6;i++){
							newList.push(globalMap.recommends[0])
						}
						globalMap.recommends = newList
					%>

            		<%  _.each( globalMap.recommends , function( item,index ){%>
            			<%
							var tag=item.tags.split(",")[0];
						%>

						<%if(index<6){%>
							<li>

								<a href="<%-getAppUrl(item.uri)%>" class="recommended_a">
									<img class="recommended_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>"  />
									<p class="recommended_name_p">
										<%-item.name%>
									</p>
									<p class="recommended_tag_p"><%-item.department%></p>
									<!-- <p class="app_pingjia">
										<%=rateInit(item.rating)%>
									</p> -->
								</a>
								<!-- <%if(!(isFavorite(item.id))){%>
									<span class="app_collect" app-identity="<%-item.id%>">
										<img src="./firstPage/favorite_no.png"  />
									</span>
								<%}else{%>
									<span class="app_collect" app-identity="<%-item.id%>" >
										<img src="./firstPage/favorite.png" />
									</span>
								<%}%> -->
								
							</li>
						<%}%>
                    <%})%>
                <%}%>
			</ul>


			<p class="index_title">热门服务</p>
			<%
            		var hotApps=[];
            		Global.stats=$.grep(globalMap.apps,function(app){
						var tags=app.tags;
		    			var tagSplit=tags.split(",");
		    			if(tagSplit.length>=5&&tagSplit[4]=="移动端"){
		    				return true;
		    			}
		    			return false;
					})
            		if(Global.stats&&Global.stats.length>0){
            			hotApps=Global.stats;
            		}
				%>
				
			<ul class="app_List">
				<%if(hotApps&&hotApps.length>0){%>
        			<%_.each(hotApps,function(item,index){%>
        				<%if(index<8){%>
        					<li>
        						<a href="<%-getAppUrl(item.uri)%>">
									<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>"  />
									<p class="app_name_p"><%-item.name%></p>
									<p class="app_tag_p"><%-item.department%></p>
									<p class="app_pingjia">
										<%=rateInit(item.rating)%>
									</p>
								</a>
								<%if(!(isFavorite(item.id))){%>
									<span class="app_collect" app-identity="<%-item.id%>">
										<img src="./firstPage/favorite_no.png"  />
									</span>
								<%}else{%>
									<span class="app_collect" app-identity="<%-item.id%>" >
										<img src="./firstPage/favorite.png" />
									</span>
								<%}%>
								
							</li>
        				<%}%>
        				
        			<%})%>
        		<%}%>
			</ul>
		</div>
</script>


	<script id="contentsAppAllTemplate" type="text/template">
	<div class="topHead">
		<div class="search_div appall">
			<a href="/taskcenter/wechat/index" class="toBack"></a>
			<%if(!Global.query.searchText){%>
				<div class="search_form_todo showForm">
					<input type="text" placeholder="搜索" class="search_input_css_todo search-input search_input_css_appall  showInput" />
					<input type="button"  class="search_btn_css_todo search-btn search_btn_css_appall" />
				</div>
			<%}else{%>
				<div class="search_form_todo">
					<input type="text" placeholder="搜索" class="search_input_css_todo search-input search_input_css_appall" />
					<input type="button"  class="search_btn_css_todo search-btn search_btn_css_appall show" />
				</div>
			<%}%>
		</div>
		<ul class="typeChoose">
			<%
            	var categoryArr=["全部"];
            	var departmentArr=["全部"];
		    	if(Global.apps&&Global.apps.length>0){
		    		_.each(Global.apps,function(app){
		    			var tags=app.tags;
		    			var tagSplit=tags.split(",");
		    			if(tagSplit.length>=5&&tagSplit[4]=="移动端"){
		    				if(!isArrExit(categoryArr,tagSplit[0])){
		    					categoryArr.push(tagSplit[0]);
		    				}
		    				if(tagSplit.length>=3){
		    					if(!isArrExit(departmentArr,tagSplit[2])){
			    					departmentArr.push(tagSplit[2]);
			    				}
		    				}
		    			}
		    		})
		    	}
            %>
            <li class="xialaFl">
				<%
					var fenlei="服务分类";
					if(Global.serviceSearch.category!="全部"){
						fenlei=Global.serviceSearch.category;
					}
				%>
				<%-fenlei%>
				<span></span>
				<div class="tagList categoryList">
					<%for(var i=0;i<departmentArr.length;i++){%>
						<p><%-departmentArr[i]%></p>
					<%}%>
				</div>
			</li>
			<li class="xialaCj">
				<%
					var changjing="服务部门";
					if(Global.serviceSearch.scene!="全部"){
						changjing=Global.serviceSearch.scene;
					}
				%>
				<%-changjing%>
			<span></span>
			<div class="tagList sceneList">
				<%for(var i=0;i<categoryArr.length;i++){%>
					<p><%-categoryArr[i]%></p>
				<%}%>
			</div>
			</li>
			
			
			
		</ul>
	</div>
	
	<%
		var letterAppGroup={};
		if(globalMap.apps&&globalMap.apps.length>0){
				var tagApps=$.grep(globalMap.apps,function(item){
					var tagArr=item.tags.split(",");
					var category=false;
					var scene=false;
					if(tagArr.length>=5&&tagArr[4]=="移动端"){
						if(Global.serviceSearch.category=="全部"){
							category=true;
						}else if(Global.serviceSearch.category!="全部"&&item.tags.indexOf(Global.serviceSearch.category)>-1){
							category=true
						}
						if(Global.serviceSearch.scene=="全部"){
							scene=true;
						}else if(Global.serviceSearch.scene!="全部"&&item.tags.indexOf(Global.serviceSearch.scene)>-1){
							scene=true
						}
						if(category==true&&scene==true){
							return true;
						}else{
							return false;
						}
						
					}else{
						return false;
					}
				})
			_.each(tagApps,function(item){
				var shouzimu=item.shouzimu;
				var firstLetter="";
				for(var i=0;i<shouzimu.length;i++){
					var code=shouzimu.charCodeAt(i);
					if((code>=97&&code<=122)||(code>=65&&code<=90)){
						firstLetter=shouzimu.charAt(i).toUpperCase();
						break;
					}
				}
				var isLetter=false;
				for(key in letterAppGroup){
					if(firstLetter==key){
						isLetter=true;
						letterAppGroup[key].push(item);
						break;
					}
				}
				if(!isLetter){
					letterAppGroup[firstLetter]=[];
					letterAppGroup[firstLetter].push(item);
				}
			})
		}
		letterAppGroup=objKeySort(letterAppGroup);
		var letterArr=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];
	%>
	<div class="mobile_content bottomBody">
		<ul class="zimuList">
			<%_.each(letterArr,function(letter){%>
				<li><a href="#<%-letter%>"><%-letter%></a></li>
			<%})%>
		</ul>
		<%for(key in letterAppGroup){%>
			<p class="p_zimu" id="<%-key%>"><%-key%></p>
           <ul class="app_List">
            	<%_.each(letterAppGroup[key],function(item){%>
            		<li>
            			<a href="<%-getAppUrl(item.uri)%>">
							<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>" />
							<p class="app_name_p"><%-item.name%></p>
							<p class="app_tag_p"><%-item.department%></p>
							<p class="app_pingjia">
								<%=rateInit(item.rating)%>
							</p>
						</a>
						<%if(!(isFavorite(item.id))){%>
	                    	<span class="app_collect" app-identity="<%-item.id%>">
								<img src="./firstPage/favorite_no.png" />
							</span>
	                    <%}else{%>
	                    	<span class="app_collect" app-identity="<%-item.id%>" >
								<img src="./firstPage/favorite.png" />
							</span>
	                    <%}%>
					</li>
            	<%})%>
            </ul>
    	<%}%>
		
		
	</div>
</script>


	<script id="contentsApplyTemplate" type="text/template">
	<div class="topHead todoHeader">
		<div class="search_div">
			<div class="search_form_todo">
				<input type="text" placeholder="请输入搜索内容" class="search_input_css_todo search-input" />
				<input type="button"  class="search_btn_css_todo btn-search-input" />
			</div>
		</div>
		<%
			globalMap._todos=grepItem(globalMap._todos);
		%>
		<ul class="mobile_nav">
			<li navtop="todo">
				<a href="<%-getLink('/taskcenter/wechat/todo')%>">
					<img src="./firstPage/nav_todo_banner_normal.png"  />
					<p>待办事项</p>
					<%if(globalMap._todos&&globalMap._todos.length>0){%>
						<span class="count"><%-globalMap._todos.length%></span>
					<%}%>
					
				</a>
			</li>
			<li navtop="myApply">
				<a href="<%-getLink('/taskcenter/wechat/myApply')%>">
					<img src="./firstPage/nav_apply_banner_normal.png"  />
					<p>我的申请</p>
				</a>
			</li>
			
			<li navtop="doing">
				<a href="<%-getLink('/taskcenter/wechat/doing')%>">
					<img src="./firstPage/nav_doing_banner_normal.png"  />
					<p>进行中</p>
				</a>
			</li>
			<li navtop="done" >
				<a href="<%-getLink('./index.htm')%>">
					<img src="./firstPage/nav_done_banner_normal.png"  />
					<p>已完成</p>
				</a>
			</li>
		</ul>
	</div>
	<%if(Global.appCode){%>
		<div class="app_container">
			<div class="layout">
				<ul class="app_List">
					<%
						if(Global.nowApp){
							var item=Global.nowApp;
					%>
						<li>
							<a href="<%-getAppUrl(item.uri)%>">
								<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>" />
								<p class="app_name_p"><%-item.name%><span>(点击办理)</p>
								<p class="app_tag_p">部门：<%-item.department%></p>
							</a>
						</li>
					<%}else if(Global.noNowApp){%>
						<p class="noNowApp">您暂时无权限办理此流程。</p>
					<%}%>
				</ul>
			</div>
		</div>
	<%}%>
	
	<div class="mobile_content bottomBody todoBottomBody">
		<%
			if( Global.myApplies && Global.myApplies.length > 0){
				Global._myApplies = grepSearch(Global.myApplies);
				Global._myApplies.sort(function(a,b){
					if(a.update>b.update){
						return -1;
					}else{
						return 1;
					}
				})
			}
		%>
		<%if(Global._myApplies&&Global._myApplies.length>0){%>
		<ul class="app_List item_list">
        		<%_.each(Global._myApplies,function(item,index){%>
        			<%if(index>=Global.page.meTodos.start&&index<Global.page.meTodos.end){%>
        				<li>
							<a href="<%-getAppUrl(item.uri)%>">
							<p class="app_name_p">
								<%-item.name%>
							</p>
							<p class="app_tag_p">流水号：<%-item.entry%></p>
							<p class="app_tag_p">当前步骤：<%-item.pendingTasks%></p>
							<p class="app_tag_p time"><%-(item.update == 0 ? "":getFormatDateByLong(item.update*1000,'yyyy-MM-dd hh:mm'))%></p>
							<span class="circle_yellow"></span>
							</a>
						</li>
        			<%}%>
        		<%})%>
        	
		</ul>
		<%}%>
		<%if(Global._myApplies && Global._myApplies.length > 0){ %>
	 		<div class="paginationContainer" pagination-type="meTodos">
	 		</div>
        <%}%>
	</div>
    </div>
</script>
	<script id="contentsDoneTemplate" type="text/template">
	<div class="topHead todoHeader">
		<div class="search_div">
			<div class="search_form_todo">
				<input type="text" placeholder="请输入搜索内容" class="search_input_css_todo search-input" />
				<input type="button"  class="search_btn_css_todo btn-search-input" />
			</div>
		</div>
		<%
			globalMap._todos=grepItem(globalMap._todos);
		%>
		<ul class="mobile_nav">
			<li navtop="todo">
				<a href="<%-getLink('/taskcenter/wechat/todo')%>">
					<img src="./firstPage/nav_todo_banner_normal.png"  />
					<p>待办事项</p>
					<%if(globalMap._todos&&globalMap._todos.length>0){%>
						<span class="count"><%-globalMap._todos.length%></span>
					<%}%>
					
				</a>
			</li>
			<li navtop="myApply">
				<a href="<%-getLink('/taskcenter/wechat/myApply')%>">
					<img src="./firstPage/nav_apply_banner_normal.png"  />
					<p>我的申请</p>
				</a>
			</li>
			
			<li navtop="doing">
				<a href="<%-getLink('/taskcenter/wechat/doing')%>">
					<img src="./firstPage/nav_doing_banner_normal.png"  />
					<p>进行中</p>
				</a>
			</li>
			<li navtop="done" >
				<a href="<%-getLink('./index.htm')%>">
					<img src="./firstPage/nav_done_banner_normal.png"  />
					<p>已完成</p>
				</a>
			</li>
		</ul>
	</div>
	<%if(Global.appCode){%>
		<div class="app_container">
			<div class="layout">
				<ul class="app_List">
					<%
						if(Global.nowApp){
							var item=Global.nowApp;
					%>
						<li>
							<a href="<%-getAppUrl(item.uri)%>">
								<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>" />
								<p class="app_name_p"><%-item.name%><span>(点击办理)</p>
								<p class="app_tag_p">部门：<%-item.department%></p>
							</a>
						</li>
					<%}else if(Global.noNowApp){%>
						<p class="noNowApp">您暂时无权限办理此流程。</p>
					<%}%>
				</ul>
			</div>
		</div>
	<%}%>
	
	<div class="mobile_content bottomBody todoBottomBody">
	<%if(globalMap.dones&&globalMap.dones.length>0){%>
		<ul class="app_List item_list">
			
        		<%_.each(globalMap.dones,function(item){%>
           		<li>
				   <a href="<%-getAppUrl(item.uri)%>">
					<p class="app_name_p">
						<%-item.name%>
					</p>
					<p class="app_tag_p">流水号：<%-item.entry%></p>
					<p class="app_tag_p">当前步骤：<%-item.pendingTasks%></p>
					<p class="app_tag_p time"><%-(item.update == 0 ? "":getFormatDateByLong(item.update*1000,'yyyy-MM-dd hh:mm'))%></p>
					<span class="circle_yellow"></span>
					</a>
					<a class="toDetail" href="javascript:;" process-identity="<%-item.id%>">明细</a>
					<%if(item.rating){%>
						<a class="toComment" href="javascript:;" rate-identity="<%-item.id%>" item-rating="<%-item.rating%>" item-review="<%-item.review%>" >已评价</a>
					<%}else if(item.owner && item.status && item.status!='killed' && item.owner.id==Global.userId){%>
						<a class="toComment" href="javascript:;" rate-identity="<%-item.id%>" >评价</a>
					<%}%>
				</li>
        		<%})%>
        	
		</ul>
		<%}%>
		<%if(globalMap.dones && globalMap.dones.length > 0){ %>
     		<div class="paginationContainer">
     			<ul id="app-pagination" pagination class="clearfix">
		            <li>上一页</li>
		            <li>#n</li>
		            <li>#n</li>
		            <li>#c</li>
		            <li>#n</li>
		            <li>下一页</li>
		        </ul>
     		</div>
	    <%}%>
	</div>
</script>
	<script id="contentsTodoTemplate" type="text/template">
	<div class="topHead todoHeader">
		<div class="search_div">
			<div class="search_form_todo">
				<input type="text" placeholder="请输入搜索内容" class="search_input_css_todo search-input" />
				<input type="button"  class="search_btn_css_todo btn-search-input" />
			</div>
		</div>
		<%
			globalMap._todos=grepItem(globalMap._todos);
		%>
		<ul class="mobile_nav">
			<li navtop="todo">
				<a href="<%-getLink('/taskcenter/wechat/todo')%>">
					<img src="./firstPage/nav_todo_banner_normal.png"  />
					<p>待办事项</p>
					<%if(globalMap._todos&&globalMap._todos.length>0){%>
						<span class="count"><%-globalMap._todos.length%></span>
					<%}%>
					
				</a>
			</li>
			<li navtop="myApply">
				<a href="<%-getLink('/taskcenter/wechat/myApply')%>">
					<img src="./firstPage/nav_apply_banner_normal.png"  />
					<p>我的申请</p>
				</a>
			</li>
			
			<li navtop="doing">
				<a href="<%-getLink('/taskcenter/wechat/doing')%>">
					<img src="./firstPage/nav_doing_banner_normal.png"  />
					<p>进行中</p>
				</a>
			</li>
			<li navtop="done" >
				<a href="<%-getLink('/taskcenter/wechat/done')%>">
					<img src="./firstPage/nav_done_banner_normal.png"  />
					<p>已完成</p>
				</a>
			</li>
		</ul>
	</div>
	<%if(Global.appCode){%>
		<div class="app_container">
			<div class="layout">
				<ul class="app_List">
					<%
						if(Global.nowApp){
							var item=Global.nowApp;
					%>
						<li>
							<a href="<%-getAppUrl(item.uri)%>">
								<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>" />
								<p class="app_name_p"><%-item.name%><span>(点击办理)</p>
								<p class="app_tag_p">部门：<%-item.department%></p>
							</a>
						</li>
					<%}else if(Global.noNowApp){%>
						<p class="noNowApp">您暂时无权限办理此流程。</p>
					<%}%>
				</ul>
			</div>
		</div>
	<%}%>
	
	<div class="mobile_content bottomBody todoBottomBody">
		<%
			batchDealWith.init(globalMap._todos);
		%>
		<!--批量办理-->
		<% if(batchDealWith.getContainDeal()){%>
		<div class="toPlbl">
			<div class="plgl">
				<input type="button" value="批量办理" onclick="batchDealWith.showDealDialog(this)" class="plgl_btn"/>
			</div>
		</div>
		<% }%>
			<!-- 批量办理提醒选择事项 -->
			<div id="dealTip" class="plbl_tx">
				请至少勾选一个事项
			</div>
			<!--批量办理操作-->
			<div id="dealDLG" class="plbl_cz">
				<div class="plbl_cz_box">
					<div class="plbl_title">
						<h3>批量办理</h3>
						<a href="#" class="plgl_close"><img src="./firstPage/plgl_close.gif" onclick="batchDealWith.hideDealDialog()" /></a>
					</div>
					<div class="plbl_tip">
						<p>批量操作将会对勾选的流程全部生效，不可撤销，请谨慎操作。</p>
					</div>
					<ul id="actions" class="plbl_xz">
						<li>
							<a href="#" class="plbl_xz_ch"><img src="./firstPage//plbl_yes.gif" /></a>
							<span>同意申请，通过</span>
						</li>
						<li>
							<a href="#" class="plbl_xz_ch"><img src="./firstPage//plbl_no.gif" /></a>
							<span>不同意</span>
						</li>
						<li>
							<a href="#" class="plbl_xz_ch"><img src="./firstPage//plbl_no.gif" /></a>
							<span>流转到下一个节点</span>
						</li>
						<li>
							<a href="#" class="plbl_xz_ch"><img src="./firstPage//plbl_no.gif" /></a>
							<span>流程终止</span>
						</li>
					</ul>
					<div class="plbl_but">
						<input type="button" value="确定" class="plbl_but1" onclick="batchDealWith.submitDeal()" />
						<input type="button" value="取消" class="plbl_but2" onclick="batchDealWith.hideDealDialog()" />
					</div>
				</div>
			</div>
		<%if(globalMap._todos&&globalMap._todos.length>0){%>
		<ul class="app_List item_list">
			<%
				if( globalMap._todos &&globalMap._todos.length > 0){
					globalMap._todos.sort(function(a,b){
						if(a.assignTime>b.assignTime){
							return -1;
						}else{
							return 1;
						}
					})
				}		
			%>
			
        		<%_.each(globalMap._todos,function(item,index){%>
        			<%if(index>=Global.page.auditingTodos.start&&index<Global.page.auditingTodos.end){%>
        				<li>
							<% if(batchDealWith.getContainDeal()){%>
								<% if(item.actions){%>
									<div class="sx_check"> <img src="./firstPage/check_<%-item.selected?'yes':'no'%>.gif" style="cursor:pointer;" onclick="batchDealWith.toggleSelect('<%-item.id%>',this)"/></div>
								<%}%>
							<%}%>
							<a href="<%-getAppUrl(item.uri)%>">
							<p class="app_name_p">
								<%-item.process.name%>
							</p>
							<p class="app_tag_p">流水号：<%-item.process.entry%></p>
							<p class="app_tag_p">当前步骤：<%-item.name%></p>
							<p class="app_tag_p time"><%-(item.assignTime == 0 ? "":getFormatDateByLong(item.assignTime*1000,'yyyy-MM-dd hh:mm'))%></p>
							<span class="circle_yellow"></span>
							</a>
						</li>
        			<%}%>
           		
        		<%})%>
        	
		</ul>
		<%}%>
		<%if(globalMap._todos && globalMap._todos.length > 0){ %>
	 		<div class="paginationContainer" pagination-type="auditingTodos">
	 			
	 		</div>
        <%}%>
	</div>
</script>
	<script id="contentsDoingTemplate" type="text/template">
	<div class="topHead todoHeader">
		<div class="search_div">
			<div class="search_form_todo">
				<input type="text" placeholder="请输入搜索内容" class="search_input_css_todo search-input" />
				<input type="button"  class="search_btn_css_todo btn-search-input" />
			</div>
		</div>
		<%
			globalMap._todos=grepItem(globalMap._todos);
		%>
		<ul class="mobile_nav">
			<li navtop="todo">
				<a href="<%-getLink('/taskcenter/wechat/todo')%>">
					<img src="./firstPage/nav_todo_banner_normal.png"  />
					<p>待办事项</p>
					<%if(globalMap._todos&&globalMap._todos.length>0){%>
						<span class="count"><%-globalMap._todos.length%></span>
					<%}%>
					
				</a>
			</li>
			<li navtop="myApply">
				<a href="<%-getLink('/taskcenter/wechat/myApply')%>">
					<img src="./firstPage/nav_apply_banner_normal.png"  />
					<p>我的申请</p>
				</a>
			</li>
			
			<li navtop="doing">
				<a href="<%-getLink('/taskcenter/wechat/doing')%>">
					<img src="./firstPage/nav_doing_banner_normal.png"  />
					<p>进行中</p>
				</a>
			</li>
			<li navtop="done" >
				<a href="<%-getLink('./index.htm')%>">
					<img src="./firstPage/nav_done_banner_normal.png"  />
					<p>已完成</p>
				</a>
			</li>
		</ul>
	</div>
	<%if(Global.appCode){%>
		<div class="app_container">
			<div class="layout">
				<ul class="app_List">
					<%
						if(Global.nowApp){
							var item=Global.nowApp;
					%>
						<li>
							<a href="<%-getAppUrl(item.uri)%>">
								<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-item.icon%>" />
								<p class="app_name_p"><%-item.name%><span>(点击办理)</p>
								<p class="app_tag_p">部门：<%-item.department%></p>
							</a>
						</li>
					<%}else if(Global.noNowApp){%>
						<p class="noNowApp">您暂时无权限办理此流程。</p>
					<%}%>
				</ul>
			</div>
		</div>
	<%}%>
	
	<div class="mobile_content bottomBody todoBottomBody">
	<%if(globalMap.doings&&globalMap.doings.length>0){%>
		<ul class="app_List item_list">
			
        		<%_.each(globalMap.doings,function(item){%>
           		<li>
				   <a href="<%-getAppUrl(item.uri)%>">
					<p class="app_name_p">
						<%-item.name%>
					</p>
					<p class="app_tag_p">流水号：<%-item.entry%></p>
					<p class="app_tag_p">当前步骤：<%-item.pendingTasks%></p>
					<p class="app_tag_p time"><%-(item.update == 0 ? "":getFormatDateByLong(item.update*1000,'yyyy-MM-dd hh:mm'))%></p>
					<span class="circle_yellow"></span>
					</a>
					<a class="toDetail" href="javascript:;" process-identity="<%-item.id%>">明细</a>
				</li>
        		<%})%>
        	
		</ul>
		<%}%>
		<%if(globalMap.doings && globalMap.doings.length > 0){ %>
     		<div class="paginationContainer">
     			<ul id="app-pagination" pagination class="clearfix">
		            <li>上一页</li>
		            <li>#n</li>
		            <li>#n</li>
		            <li>#c</li>
		            <li>#n</li>
		            <li>下一页</li>
		        </ul>
     		</div>
	    <%}%>
	</div>
</script>
	<script id="contentsItemViewTemplate" type="text/template">
	<div class="detail_header">
		<%if(Global.pathName=="doing"){%>
			<a href="<%-getLink('/taskcenter/wechat/doing')%>"><span class="toLeft"></span></a>
		<%}else if(Global.pathName=="done"){%>
			<a href="<%-getLink('/taskcenter/wechat/done')%>"><span class="toLeft"></span></a>
		<%}%>
		明细
	</div>

	<div class="mobile_content" style="padding-top: 0px;">
		<%
			if(globalMap.processes && globalMap.processes.length>0){
				var process = globalMap.processes[0];
		%>
		<ul class="app_List item_list">
			<li>
				<a href="<%-process.uri%>">
				<p class="app_name_p">
					<%-process.name%>
				</p>
				<p class="app_tag_p">流水号：<%-process.entry%></p>
				<p class="app_tag_p">当前步骤：<%-process.pendingTasks%></p>
				<p class="app_tag_p time"><%-prettyDate(process.update*1000)%></p>
				<%if(process.milestones && process.milestones.length>0){%>
					<div class="app_process">
						<p>已完成<%-((process.milestone && process.milestone.percent) || 0)%>%</p>
						<p class="app_process_outer">
							<span class="app_process_inner" style="width: <%-((process.milestone && process.milestone.percent) || 0)%>px;"></span>
						</p>
					</div>
				<%}%>
				</a>
				
			</li>
		</ul>
		<%if(process.tasks&&process.tasks.length>0){%>
			<ul class="detail_list">
				<%_.each(process.tasks,function(task,index){%>
					<%if(task.status==1){%>
						<li class="now">
							<div class="detail_list_left">
								<p>当前</p>
							</div>
							<div class="detail_list_right">
								<p class="title"><%-task.name%></p>
								<p>状态：办理中...</p>
							</div>
						</li>
					<%}else{%>
						<li>
							<div class="detail_list_left">
								<p><%-(task.actionTime == 0 ? "":getFormatDateByLong(task.actionTime*1000,'yyyy-MM-dd hh:mm'))%></p>
							</div>
							<div class="detail_list_right">
								<p class="title"><%-task.name%></p>
								<p>状态：<%-task.actionName%>.</p>
								<%
									var actionUser="";
									if(task.actionUser&&task.actionUser.name){
										if(task.actionUser.name!="[hidden]"){
											actionUser=task.actionUser.name;
										}
									}
								%>
								<p>办理用户：<%-actionUser%></p>
							</div>
						</li>
					<%}%>
				<%})%>
				
			</ul>
		<%}%>
		
	<%}%>
	</div>
</script>
	<script id="contentsFavoriteTemplate" type="text/template">
	<div class="search_div appall">
		<a href="/taskcenter/wechat/index" class="toBack"></a>
		<%if(!Global.query.searchText){%>
			<div class="search_form_todo showForm">
				<input type="text" placeholder="搜索" class="search_input_css_todo search-input search_input_css_appall  showInput" />
				<input type="button"  class="search_btn_css_todo search-btn search_btn_css_appall" />
			</div>
		<%}else{%>
			<div class="search_form_todo">
				<input type="text" placeholder="搜索" class="search_input_css_todo search-input search_input_css_appall" />
				<input type="button"  class="search_btn_css_todo search-btn search_btn_css_appall show" />
			</div>
		<%}%>
	</div>
	<div class="mobile_content" style="padding-top: 0px;">
        <% 
        	var favoriteApps=getFavoriteApp();
        	favoriteApps=$.grep(favoriteApps,function(app){
				var tags=app.tags;
    			var tagSplit=tags.split(",");
    			if(tagSplit.length>=5&&tagSplit[4]=="移动端"){
    				return true;
    			}
    			return false;
			})
        	favoriteApps=grepApps(favoriteApps);
        	
        %>
		<% if(favoriteApps&&favoriteApps.length>0){%>
        		<ul class="app_List">
	        	<%_.each(favoriteApps,function(app,index){%>
	        		
	        		<%
    					var tag=app.tags.split(",")[0];
    				%>
    				<li>
						<img class="app_img" src="./firstPage/app_img_01.png" data-url="<%-app.icon%>" />
						<p class="app_name_p">
							<a href="<%-getAppUrl(app.uri)%>"><%-app.name%></a>
						</p>
						<p class="app_tag_p"><%-app.department%></p>
						<p class="app_pingjia">
							<%=rateInit(app.rating)%>
						</p>
						<%if(!(isFavorite(app.id))){%>
	                    	<span class="app_collect" app-identity="<%app.id%>">
								<img src="./firstPage/favorite_no.png" />
							</span>
	                    <%}else{%>
	                    	<span class="app_collect" app-identity="<%-app.id%>">
								<img src="./firstPage/favorite.png" />
							</span>
	                    <%}%>
					</li>
	        	<%})%>
	        	</ul>
	        <%}else if(Global.isLoading==false){%>
        		<p class="noFavorite">您当前没有收藏！</p>
        	<%}%>
	</div>	
</script>
	<script id="rateViewTemplate" type="text/template">
	<div class="detail_header">
		<a href="./index.htm"><span class="toLeft"></span></a>
		评分评价
	</div>
	<div class="mobile_content">
		<div class="commentContainer">
			<div class="comment_header">
				给出您的评分
				<div class="comment_xin">
					<div class="rateit comment_xin_div"  data-rateit-resetable="false" data-rateit-step="1" data-rateit-starwidth="16" data-rateit-starheight="16"></div>
				</div>
			</div>
			<p>
				<textarea placeholder="给出您的意见或建议"><%-Global.rate.review%></textarea>
			</p>
			<p>
				<input value="提交" type="button" class="commentSubmit" />
			</p>
		</div>
	</div>
</script>
	<script id="rateTemplate" type="text/template">
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="myModalLabel">评价确认</h4>
			</div>
			<div class="modal-body">
				<div>
					<h3 >评分： </h3>
					<div class="rateit bigstars"  data-rateit-resetable="false" data-rateit-step="1" data-rateit-starwidth="32" data-rateit-starheight="32"></div>
				</div>
				<div style="padding-top:10px;">
					<h5><span>评价备注：</span></h5>
					<textarea class="form-control" ><%-Global.rate.review%></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary modal-submit" >
					确认
				</button>
				<button type="button" class="btn btn-default modal-remove" >
					关闭
				</button>
			</div>
		</div>
	</div>
</div>
</script>

	<script type="text/javascript">
		var hasError = false;
		function showError(content) {
			hasError = true;
			window.FLOW.change();
			template(Global.contentSelector);
		};
		function grepThing() {
			globalMap.meTodos = $.grep(globalMap.meTodos, function (todo) {
				return !(todo && todo.thing);
			});
			globalMap.auditingTodos = $.grep(globalMap.auditingTodos, function (todo) {
				return !(todo && todo.thing);
			});
			globalMap.topTodos = $.grep(globalMap.topTodos, function (todo) {
				return !(todo && todo.thing);
			});

			globalMap.thingTodos = globalMap.todos;
			globalMap.thingTodos = $.grep(globalMap.thingTodos, function (todo) {
				return (todo && todo.thing);
			});
		}
		function isFavorite(key) {
			if (Global['apiFavorites']) {
				var favoriteApps = Global['apiFavorites'].favoriteApps;
				if (favoriteApps) {
					for (var i = 0; i < favoriteApps.length; i++) {
						if (favoriteApps[i] == key) {
							return true;
						}
					}
				}
			}
			return false;
		}

		function getFavoriteApp() {
			var favoriteApps = [];
			if (Global["apps"]) {
				var apps = Global['apps'];
				for (var i = 0; i < apps.length; i++) {
					if (isFavorite(apps[i].id)) {
						favoriteApps.push(apps[i]);
					}
				}
			}
			return favoriteApps;
		}

		function checkSticks(id) {
			if (globalMap.sticks) {
				for (var key in globalMap.sticks) {
					if (id == key) {
						return true;
					}
				}
			}
			return false;
		}

		function grepSearch(taskArr) {
			return $.grep(taskArr, function (process, i) {
				var choosenFile = Global.filterSearch;
				var searchText = "";
				if (choosenFile) {
					searchText = choosenFile
				}
				if (Global.query.searchText) {
					if (searchText) {
						searchText = searchText + " " + Global.query.searchText;
					} else {
						searchText = Global.query.searchText;
					}
				}
				if (!searchText) {
					return true;
				}
				var searchArr = searchText.split(" ");
				var count = 0;
				var searchArrLen = searchArr.length;
				for (var i = 0; i < searchArrLen; i++) {
					var name = "";
					var entry = "";
					var tags = "";
					var appName = "";
					if (process.process) {
						name = process.process.name;
						entry = process.process.entry;
						appName = process.process.app.name;
						tags = process.process.app.tags;
					} else {
						name = process.name;
						entry = process.entry;
						appName = process.app.name;
						tags = process.app.tags;
					}
					if ((name || "").indexOf(searchArr[i]) > -1
						|| entry == searchArr[i] || (appName || "").indexOf(searchArr[i]) > -1 || (tags || "").indexOf(searchArr[i]) > -1) {
						count++;
					}
				}
				if (count == searchArrLen) {
					return true;
				} else {
					return false;
				}
			});
		}
		function grepApps(appArr) {
			return $.grep(appArr, function (app, i) {
				if (!Global.query.searchText) {
					return true;
				}
				var searchArr = Global.query.searchText.split(" ");
				var count = 0;
				var searchArrLen = searchArr.length;
				for (var i = 0; i < searchArrLen; i++) {
					if ((app.name || "").indexOf(searchArr[i]) > -1) {
						count++;
					}
				}
				if (count == searchArrLen) {
					return true;
				} else {
					return false;
				}
			});
		}

		function todoPagination() {
			if (globalMap._todos || Global._myApplies) {
				$('.paginationContainer').each(function () {
					var thzz = this;
					$(thzz).empty();
					var paginationType = $(thzz).attr('pagination-type');
					if (paginationType == "auditingTodos") {
						var _auditTodos = globalMap._todos;
						var length = _auditTodos.length || 0;
					} else {
						var _meTodos = Global._myApplies;
						var length = _meTodos.length || 0;
					}
					var page = Global.page[paginationType].page || 1;
					var pageSize = Global.page[paginationType].pageSize || 10;
					if (length == 0) return;
					//			if(length < pageSize) return;
					var pageHtml = '<ul id="app-pagination" class="clearfix"><li>上一页</li><li>#n</li><li>#n</li><li>#c</li><li>#n</li><li>下一页</li></ul>';
					$(thzz).append(pageHtml);
					$(thzz).find('#app-pagination').easyPaging(length, {
						page: page,
						perpage: pageSize,
						onSelect: function (page) {
							$(thzz).find("#app-pagination li a").click(function () {
								var page = $(this).attr('data-page');
								if (page) {
									var start = (parseInt(page) - 1) * pageSize;
									var end = start + pageSize;
									Global.page[paginationType] = { start: start, end: end, page: page, pageSize: pageSize };
								}
							});
						}
					});
				});
			}
		}

		var desc = function (x, y) {
			return (x.processCounters.count < y.processCounters.count) ? 1 : -1
		}


		function controlStrLength(str, Len) {
			var strLength = str.length;
			if (strLength > Len) {
				for (var i = 0; i < Len; i++) {
					str = str.substring(0, Len);
				}
				return str.concat("...");
			} else {
				return str;
			}
		}

		function getUrlParam(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
			var r = window.location.search.substr(1).match(reg);
			if (r != null) return decodeURI(r[2]);
			return null;
		}
		function getURL(process) {
			if (process) {
				var tasks = [];
				if (Global.approval && Global.approval.length > 0) {
					$.each(Global.approval, function (key, todo) {
						if (todo.process.id == process.id) {
							tasks.push(todo);
						}
					});
				}

				var url = process.uri;
				if (tasks.length > 1) {
					return url;
				} else {
					if (tasks.length == 1) {
						url = tasks[0].uri;
					}
					var appUrl = getAppUrl(url);
					return appUrl;
				}
			}
			return "";
		}
		function objKeySort(obj) {//排序的函数
			var newkey = [];
			for (var key in obj) {
				newkey.push(key);
			}
			newkey = newkey.sort();

			var newObj = {};//创建一个新的对象，用于存放排好序的键值对
			for (var i = 0; i < newkey.length; i++) {//遍历newkey数组
				newObj[newkey[i]] = obj[newkey[i]];//向新创建的对象中按照排好的顺序依次增加键值对
			}
			return newObj;//返回排好序的新对象
		}

		function controlStrLength(str, Len) {
			var strLength = str.length;
			if (strLength > Len) {
				for (var i = 0; i < Len; i++) {
					str = str.substring(0, Len - 1);
				}
				return str.concat("...");
			} else {
				return str;
			}
		}
		//判断数组中是否有那一项
		function isArrExit(arr, str) {
			var isExit = false;
			if (arr.length == 0) {
				isExit = false;
			} else {
				for (var j = 0; j < arr.length; j++) {
					if (arr[j] == str) {
						isExit = true;
						break;
					}
				}
			}
			return isExit;
		}
		function grepItem(todos) {
			if (todos && todos.length > 0) {
				todos = $.grep(todos, function (process) {
					if (process.process) {
						process = process.process;
					}
					if (!Global.filterSearch) {
						return true;
					} else {
						var appName = process.app ? process.app.name : "";
						var tags = process.app.tags ? process.app.tags : "";
						var choosenFile = Global.filterSearch;
						var appProcessName = process ? process.name : "";
						if ((appName && appName.indexOf(choosenFile) > -1) || (appProcessName && appProcessName.indexOf(choosenFile) > -1) || (tags && tags.indexOf(choosenFile) > -1)) {
							return true;
						}
					}
					return false;
				})
			}
			return todos;
		}
		function getLink(url) {
			if (Global.appCode) {
				url += "?appCode=" + Global.appCode;
			} else if (Global.filterSearch) {
				url += "?filterSearch=" + Global.filterSearch;
			};
			return url;
		}
		$(document).ready(function () {
			Global.serviceSearch = {
				category: "全部",
				scene: "全部"
			}
			$.extend(Global.selectorMap, {
				"[template]": "click", ".stand-re-left li": "click"
				, ".stand-img-send a.stand-img-send-collect": "click", ".carousel-collect": "click", ".pr-select": "click",
				".add-top": "click", ".remove-top": "click", "[process-identity]": "click", "[tag-select] a.tag-select-a": "click",
				".select-view-type a.selectType": "click", ".priority_pagination li": "click", "#selectContent-xiala li": "click", ".rq": "click", "#app-pagination li a": "click", ".tagList p": "click", "[app-identity]": "click"
			});
			$.extend(Global.hashMap, { "appall": "contentsAppAllTemplate", "favorite": "contentsFavoriteTemplate", "myApply": "contentsApplyTemplate" });
			$.extend(Global.apiMap, { "api/me/processes/merge?sep=false": "myApplies" });
			Global.scrollTop = false;
			Global.handleStart = false;
			Global.titleMap = { "apps": "服务大厅", "todo": "待办事项", "myApply": "我的申请", "doing": "进行中", "done": "已完成", "appall": "服务中心", "favorite": "我的收藏" };
			Global.collectPageNow = 1;
			Global.page = { 'auditingTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'meTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'appall': { start: 0, end: 8, page: 1, pageSize: 8 } };
			Global.pageSearch = function (item) {
				if ($(".search-input").size() > 0) {
					var searchText = $(".search-input").val();
					var searchTextArr = searchText.split(",");
					for (var i = 0; i < searchTextArr.length; i++) {
						if (searchTextArr[i] != "") {
							if (!searchText || (item.process.name || "").indexOf(searchTextArr[i]) > -1 || item.process.entry == searchTextArr[i]
								|| item.process.owner.account == searchTextArr[i] || (item.process.owner.name || "").indexOf(searchTextArr[i]) > -1 || item.process.app.name.indexOf(searchTextArr[i] || (item.process.app.tags || "").indexOf(searchTextArr[i]) > -1) > -1
							) {
								return true;
							}
						}
					}
				}
				return false;
			}
			if (Global.pathName == "appall") {
				var chooseTag = getUrlParam("chooseTag");
				if (chooseTag != null) {
					Global.query.choosenTag = chooseTag;
				}
			}
			window.templateBind = function () {
				$('[process-identity]').click(function () {
					var id = $(this).attr('process-identity');
					returnUrl = $(this).attr('return-url');
					processIdentity = id;
					Global.templateSelector = "#contentsItemViewTemplate";
					window.FLOW.init('processes', 'api/process_id.json', function () {
						Global.isLoading = false;
					});
				});

				$('[rate-identity]').click(function () {
					var id = $(this).attr('rate-identity');
					Global.rate = {
						id: id,
						rating: $(this).attr('item-rating') || 0,
						review: $(this).attr('item-review') || ""
					}
					$('.stand-main-content').html(_.template($('#rateViewTemplate').html(), {}));
					$('.rateit').rateit({
						step: 1
					});
					$('.comment_xin_div').rateit('value', Global.rate.rating);
					$('.commentSubmit').click(function () {
						Global.rate.review = $('.commentContainer textarea').val();
						var rating = $('.comment_xin_div').rateit('value') || 0;
						if (!$.isNumeric(rating)) {
							rating = Global.rate.rating;
						}
						if (rating < 3 && !Global.rate.review) {
							layer.alert("评分低于3分请给出评论！");
							return false;
						}
						$.ajax({
							async: false,
							type: "get",
							url: Global.contentpath + 'api/process/' + id + "?action=rate&rating=" + rating + "&comment=" + Global.rate.review,
							success: function (json) {
								if (json && json.errno == 0) {
									layer.confirm("评价完成！", function () {
										location.reload();
									});
								} else {
									layer.alert("评价失败！");
								}
							},
							error: function (xhr, error) {
							}
						});
					});
				});



				$(".sceneList p").click(function () {
					var scene = $(this).html();
					Global.serviceSearch.scene = scene;
				})
				$(".categoryList p").click(function () {
					var category = $(this).html();
					Global.serviceSearch.category = category;
				})
				$(".xialaCj").click(function () {
					$(".sceneList").toggleClass("show");
					$(this).find("span").toggleClass("xiala");
					$(".categoryList").removeClass("show");
					$(this).find("span").removeClass("xiala");
				})
				$(".xialaFl").click(function () {
					$(".categoryList").toggleClass("show");
					$(this).find("span").toggleClass("xiala");
					$(".sceneList").removeClass("show");
					$(this).find("span").removeClass("xiala");
				})
				if (Global.pathName == "todo" || Global.pathName == "myApply") {
					todoPagination();
				}





				$('.tag-select').change(function () {
					Global.query.choosenTag = $(this).val();
					FLOW.prevChoosenTag();
				});

				$('[tag-select] a.tag-select-a').click(function () {
					Global.query.choosenTag = $.trim($(this).text());
					FLOW.prevChoosenTag();
					Global.appallPage = { 'appall': { start: 0, end: 8, page: 1, pageSize: 8 } }
					if (Global.pathName == "appall") {
						doAppallPage();
					}
				});

				$('[app-identity]').click(function () {
					collectAjax = false;
					var id = $(this).attr('app-identity');
					var method = "put", type = "PUT";
					if (isFavorite(id)) {
						method = "del";
						type = "DELETE";
					}
					$.ajax({
						url: Global.contentpath + "api/me/preference/FavoriteApps/" + id + "?method=" + method,
						async: false,
						success: function (response) {
							if (response.errno == 0 && response.entities && response.entities.length > 0) {
								Global['apiFavorites'] = response.entities[0];
								collectAjax = true;
							} else {
								showError(response.error);
							}
						}
					});
				});

				$('.search-btn').click(function () {
					if (Global.dataName == "todos") {
						batchDealWith.resetSelect(globalMap._todos);
					}

					Global.query.searchText = $('.search-input').val();
					FLOW.init(Global.dataName);
					if (Global.pathName == "todo" || Global.pathName == "apply") {
						Global.page = { 'auditingTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'meTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'appall': { start: 0, end: 8, page: 1, pageSize: 8 } };
						todoPagination();
					}
				});

				$('.search-input').keydown(function (event) {
					if (event.keyCode == 13) {
						if (Global.dataName == "todos") {
							batchDealWith.resetSelect(globalMap._todos);
						}
						Global.query.searchText = $('.search-input').val();
						FLOW.init(Global.dataName);
						if (Global.pathName == "todo" || Global.pathName == "apply") {
							Global.page = { 'auditingTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'meTodos': { start: 0, end: 10, page: 1, pageSize: 10 }, 'appall': { start: 0, end: 8, page: 1, pageSize: 8 } };
							todoPagination();
						}
					}
				});
				$(".search_input_css_appall").blur(function () {
					if ($(this).val() == "") {
						$(this).addClass("showInput");
						$(".search_form_todo").addClass("showForm");
						$(".search_btn_css_appall").removeClass("show");
					}
				})
				$(".search_input_css_appall").focus(function () {
					$(this).removeClass("showInput");
					$(".search_form_todo").removeClass("showForm");
					$(".search_btn_css_appall").addClass("show")
				})
				$(".search_btn_in").click(function () {
					window.location.href = "/taskcenter/wechat/appall" + "?searchq=" + $('.search_input_in').val();
				})
				$('.search_input_in').keydown(function (event) {
					if (event.keyCode == 13) {
						window.location.href = "/taskcenter/wechat/appall" + "?searchq=" + $('.search_input_in').val();
					}

				});
				$(".text").click(function () {
					window.location.href = "/taskcenter/logout"
				})
				$(".slide-btn").click(function () {
					$(this).parents(".fl").toggleClass("open");
					if (Global.open) {
						Global.open = false;
					} else {
						Global.open = true;
					}
				})
				$(".select-view-type a.selectType").click(function () {
					Global.selectType = $(this).attr("showType");
				})
				$(".my-favorite-tab li").click(function () {
					var nowPage = $(this).find("a").attr("data-page");
					Global.collectPageNow = nowPage;
				})
				$("#selectContent-xiala li").click(function () {
					var selectNum = parseInt($(this).find("a").html());
					Global.page.appall = { start: 0, end: selectNum, page: 1, pageSize: selectNum };
					if (Global.pathName == "appall") {
						doAppallPage();
					}
				})
				//app-menu
				$("#app-menu").click(function (event) {
					event.stopPropagation();
					$(".nav").css("right", "0%");
				});
				$(document).click(function (event) {
					var _con = $('.mobile_nav');
					if (!_con.is(event.target) && _con.has(event.target).length === 0) { // Mark 1
						//$('#divTop').slideUp('slow');   //滑动消失
						$(".mobile-nav").css("right", "-100%");    //淡出消失
					}
				})
				$(".slide-btn").click(function () {
					$(".slide-items").slideToggle();
				});
				$(".sf h5").click(function () {
					$(this).next().slideToggle();
				})
				$(".fl h5").click(function () {
					$(this).next().slideToggle();
				})

				$(".rq").click(function () {
					if (globalMap.tagApps) {
						globalMap.tagApps[Global.query.choosenTag].apps.sort(descCounts);
					}
				})
				$("span.toAppAll").click(function () {
					var chooseTag = $(this).attr("chooseTag");
					window.location.href = "/taskcenter/workflow/appall" + "?chooseTag=" + chooseTag;
				})
				$(".stuList,.teachList").find("a").css("cursor", "default").click(function () {
					return false;
				})

			}

			window.endingRender = function () {
				$("[navtop=" + Global.pathName + "]").addClass("active");
				var img = $("[navtop=" + Global.pathName + "]").find("img");
				if (img.size() > 0) {
					img.attr("src", img.attr("src").replace("_normal", ""));
				}

				var approvalLength = 0;
				$('[data-url]').each(function () {
					var data_url = $(this).attr('data-url');
					$(this).attr('src', data_url);
				});
				//		getStats();
			};
		});
		// 一键办理 功能模块
		var batchDealWith = (function () {
			var canContainDeal = false;
			var allItems = [];
			var dealItems = [];
			var selectedItems = [];
			var locked = false;
			var init = function (items) {
				allItems = items;
				for (i in items) {
					//alert(items[i].actions);
					if (items[i].actions) {
						canContainDeal = true;
						break;
					}
				}
			};
			var resetSelect = function (items) {
				selectedItems = [];
				_.each(items, function (item) {
					if (item.actions) {
						item.selected = false;
					}
				})
			}

			var toggleSelect = function (id, ele) {
				var start = new Date().getTime();
				if (locked == true) {
					alert("locked");
				}
				locked = true;
				var selected = ele.src.indexOf("yes") != -1 ? true : false;
				//alert(allItems.length);
				//console.log("id:"+id);
				for (var i = 0; i < allItems.length; i++) {
					var item = allItems[i];
					//console.log(allItems[i].id);

					if (item.id == id) {

						if (selectedItems.length == 0 && !selected) {
							item.selected = true;
							selectedItems.push(item);
							ele.src = ele.src.replace(selected ? "yes" : "no", selected ? "no" : "yes");
							break;
						}
						var lastSelected = selectedItems[0];
						console.log(item);
						var isSame = ($.trim(item.process.app.name) == $.trim(lastSelected.process.app.name))
							&& ($.trim(item.name) == $.trim(lastSelected.name));
						if (!selected && isSame) {
							item.selected = true;
							selectedItems.push(item);
							ele.src = ele.src.replace(selected ? "yes" : "no", selected ? "no" : "yes");
							break;
						} else if (selected && isSame) {
							item.selected = false;

							for (var j = 0; j < selectedItems.length; j++) {
								if (selectedItems[j].id == id) {
									selectedItems.splice(j, 1);
									//alert(selectedItems.length);
									break;
								}
							}
							ele.src = ele.src.replace(selected ? "yes" : "no", selected ? "no" : "yes");
							break;
						} else {
							$("#dealTip").text("请确保事项名称和步骤名称相同！");
							$("#dealTip").fadeIn();
							var t = setTimeout(function () {
								$("#dealTip").fadeOut();
								clearTimeout(t);
							}, 2000);

							break;
						}

					}
				}
				//alert(selectedItems.length);

				locked = false;
				var end = new Date().getTime();
				console.log(end - start);
			};

			var showDealDialog = function () {

				if (selectedItems.length > 0) {
					var selectedItem = selectedItems[0];
					var actions = selectedItem.actions;
					var actionsHtml = "";
					var templateStr = '<li><a href="#" class="plbl_xz_ch"><img class="actionImg" src="./firstPage/plbl_no.gif" onclick="batchDealWith.selectAction(this);" id="[id]" code="[code]" name="[name]"/></a><span>[name]</span></li>';
					for (var i in actions) {
						var action = actions[i];
						actionsHtml += templateStr.replace(/\[id\]/g, action.id).replace(/\[code\]/g, action.code).replace(/\[name\]/g, action.name);

					}
					$("#actions").html(actionsHtml);
					$("#dealDLG").fadeIn();

				} else {
					$("#dealTip").text("请至少勾选一个事项");
					$("#dealTip").fadeIn();
					var out = setTimeout(function () {
						$("#dealTip").fadeOut(800);
						clearTimeout(out);
					}, 1000);


				}
			};
			var hideDealDialog = function () {
				for (var i in selectedItems) {
					selectedItems[i].selected = false;
				}
				selectedItems.splice(0, selectedItems.length);
				$("#dealDLG").fadeOut();
				template();
			};
			var submitDeal = function () {
				var actionName = "";
				$("#actions").find("img").each(function (index, item) {
					if ($(item).attr("src").indexOf("yes") != -1) {
						actionName = $(item).attr("name");
					}
				});
				if ($.trim(actionName) == "") {
					return;
				}
				var count = 0;
				Global.handleStart = true;
				for (var i in selectedItems) {
					var selected = selectedItems[i];
					var taskId = selected.id;
					var actionId = "";
					var review = "";
					var actions = selected.actions;
					for (var j in actions) {
						var action = actions[j];
						if (action.name == actionName) {
							actionId = action.id;
							break;
						}
					}
					if ($.trim(actionId) != "") {
						$.ajax({
							type: "get",
							async: false,
							url: "/taskcenter/" + "api/task_new/" + taskId,
							data: { "actionId": actionId, "remark": this.review },
							dataType: "json",
							success: function (result) {
								if (result.errno == 0) {
									//alert(selected.process.entry+"审批成功！");

								} else {
									//alert(selected.process.entry+"审批失败！");
								}
								count++;
								if (count == selectedItems.length) {
									window.init();
								}
								setTimeout(function () {
									Global.handleStart = false;
								}, 2000)

							}
						});
					}
				}
				selectedItems.splice(0, selectedItems.length);
				init();
			};
			var getContainDeal = function () {
				return canContainDeal;
			}
			var selectAction = function (ele) {
				$(".actionImg").attr("src", ele.src.replace("yes", "no"));
				var selected = ele.src.indexOf("plbl_yes.gif") != -1;
				ele.src = ele.src.replace(selected ? "yes" : "no", selected ? "no" : "yes");
			}
			return {
				getContainDeal: getContainDeal,
				init: init,
				toggleSelect: toggleSelect,
				showDealDialog: showDealDialog,
				hideDealDialog: hideDealDialog,
				submitDeal: submitDeal,
				selectAction: selectAction,
				resetSelect: resetSelect

			}

		})();
	</script>

	<div class="modal-qh"></div>
	<div class="modal-rate"></div>
	<iframe src="./firstPage/refresh.html" style="display: none;"></iframe>
	<script src="./firstPage/infoplus.sdk.js"></script>
	<script src="./firstPage/jquery.hDialog.min.js"></script>
	<script src="./firstPage/unslider-min.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			var check = InfoPlusSDK.checkBrowser();
			if (!check)
				return;
			InfoPlusSDK.message.create('d4ffb101-0153-11eb-987b-0242ac110002', 'http://infoplus.seu.edu.cn/infoplus/message/sub').sub("task", function (message) {
				if (!Global.handleStart) {
					init();
				}

			});
		});
	</script>

	<script type="text/javascript">
		window.onpageshow = function (event) {
			//event.persisted 判断浏览器是否有缓存, 有为true, 没有为false
			if (event.persisted) {
				window.location.reload();
			}
		}
	</script>

	<script>
		function strExit(str, res) {
			var data = res.entities;
			for (var i = 0; i < data.length; i++) {
				var postName = data[i].post.name;
				if (str == postName) {
					return true;
				}
			}
			return false;
		}
		var desc = function (x, y) {
			var x_count = 0;
			var y_count = 0;
			if (x.processCounters.count) {
				x_count = x.processCounters.count;
			}
			if (y.processCounters.count) {
				y_count = y.processCounters.count;
			}
			return (x_count < y_count) ? 1 : -1
		}
		function getAppStats() {
			if (Global.pathName == "apps") {
				//获取全部流程的发起数量，用来显示热门事项
				$.ajax({
					type: "get",
					url: Global.contentpath + "api/stats/apps",
					dataType: "json",
					success: function (data) {
						var entities = data.entities;
						if (entities && entities.length > 0) {
							for (var j = 0; j < Global.apps.length; j++) {
								for (var i = 0; i < entities.length; i++) {
									Global.apps[j].processCounters = {};
									if (entities[i].id == Global.apps[j].id) {
										Global.apps[j].processCounters = entities[i].processCounters;
										break;
									}
								}
							}
							globalMap.apps.sort(desc);
							template();
						}
					}
				})
			}
		}
		function SlToString(data) {
			if (data.length % 2) return '';
			var tmp = '';
			for (i = 0; i < data.length; i += 2) {
				tmp += '%' + data.charAt(i) + data.charAt(i + 1);
			}
			return decodeURI(tmp);
		}
		function checkEnAndCh(val) {
			var isletter = /^[a-zA-Z]+$/.test(val);
			var isCh = /[\u4E00-\u9FA5]+/.test(val);
			if (isCh || isletter) {
				return true;
			}
			return false;
		}
		$(document).ready(function () {
			window.FLOW.go(function () {
				window.FLOW.change();
				if (Global.pathName == "appall") {
					Global.query.searchText = getUrlParam("searchq");
				}
				if (getUrlParam("filterSearch")) {
					if (checkEnAndCh(getUrlParam("filterSearch"))) {
						Global.filterSearch = getUrlParam("filterSearch");
					} else {
						Global.filterSearch = SlToString(getUrlParam("filterSearch"));
					}

				}
				if (getUrlParam("appCode")) {
					Global.appCode = getUrlParam("appCode");
				}
				template();
			});
			$("#myTab li").click(function () {
				if ($('a .fa-spinner', this).length == 0) {
					$('a', this).prepend('<i class="fa fa-spinner fa-spin"></i>&nbsp;&nbsp;&nbsp;');
				}
			});
			(init = function () {
				if (Global.appCode) {
					$.ajax({
						type: "get",
						url: Global.contentpath + "api/me/apps",
						dataType: "json",
						success: function (data) {
							var entities = data.entities;
							if (entities && entities.length > 0) {
								for (var i = 0; i < entities.length; i++) {
									if (Global.appCode == entities[i].code) {
										Global.nowApp = entities[i];
										Global.filterSearch = entities[i].name;
										break;
									}
								}
							}
							if (Global.filterSearch) {
								window.FLOW.init(Global.dataName, null, function () {
									getAppStats();
								});
								if (Global.dataName != "todos") {
									window.FLOW.init("todos");
								}
							} else {
								Global.noNowApp = true;
								template();
							}
						}
					})
				} else {
					window.FLOW.init(Global.dataName, null, function () {
						getAppStats();
					});
					if (Global.dataName != "todos") {
						window.FLOW.init("todos");
					}
				}
				if (Global.dataName == "apps") {
					$.ajax({
						type: "GET",
						url: Global.contentpath + "api/me/preference/FavoriteApps",
						dataType: "json",
						async: false,
						success: function (response) {
							if (response.errno == 0 && response.entities && response.entities.length > 0) {
								Global['apiFavorites'] = response.entities[0];
							} else {
								showError(response.error);
							}
						}
					});
				}
			})();

		});

	</script>
	<!--[if lte IE 8]>
		<script src="/taskcenter/resources/seu/default/js/index-ie8.js"></script>
	<![endif]-->



</body>

</html>